
from cmath import sqrt, polar, rect, exp
from math import ceil, floor, pi

def cbrt(x):
    r, theta = polar(x) 
    return rect(r**(1/3), theta/3)
class Theorem: 
    @staticmethod
    def cM2(n, k):
        """Complementary second Zagreb index for maximal graphs"""
        return k*(n-k)*((n-1)**2-k**2)

    @staticmethod
    def relaxed_max_cM2(n):
        """Solution of cM2_k(n, k) == 0 over reals"""
        xi = 6 * cbrt(-3)**2 * (8 + n*(-16 + 11*n))
        psi = -9 * (n - 2) * n * (3*n - 2) + 4 * sqrt(3) * sqrt(
            -(n - 1)**2 * (32 + n*(-128 + n*(201 + 2*n*(-73 + 34*n)))))
        return (1/72 * (18*n + xi / cbrt(psi) - 6 * cbrt(-3) * cbrt(psi))).real

    def gamma(self, n):
        """By theorem. Equivalent to arg_max_cM2"""
        A = 9*(n-2)*n*(3*n-2) + 4*sqrt(3)*sqrt(-(n-1)**2 * (n*(n*(2*n*(34*n - 73) + 201) - 128) + 32))
        B = (16 - 11*n)*n - 8 
        p = exp(1j * pi / 3)
        h = 1/12 * (3*n - cbrt(3) * p**4 * cbrt(A) + 3**(2/3)*B/(p**4*cbrt(A)))
        h = h.real
        if self.cM2(n, ceil(h)) == self.cM2(n, floor(h)):
            return (floor(h), ceil(h))
        return max([floor(h), ceil(h)], key=lambda k: self.cM2(n, k))
    
    def tuple_gamma(self, n):
        """Always returns tuple, since gamma sometimes gives tuple."""
        k = self.gamma(n) 
        return tuple({k}) if isinstance(k, int) else k

    def arg_max_cM2(self, n):
        """argmax_k cM2(n, k)"""
        k = self.relaxed_max_cM2(n)
        if self.cM2(n, ceil(k)) == self.cM2(n, floor(k)):
            return (floor(k), ceil(k))
        return max(
            [floor(k), ceil(k)], 
            key=lambda k: self.cM2(n, k)
            )
    
    def max_cM2(self, n):
        return self.cM2(n, self.tuple_gamma(n)[0])
    
    @staticmethod
    def cyclomatic_number_of(n, k):
        return k*(n-k) + k*(k-1)/2 - n + 1
    
    @staticmethod
    def concave_on(n):
        """Interval on which cM2, for maximal graphs, is convex."""
        term = sqrt(11*n**2 - 16*n + 8).real / (4 * sqrt(3))
        return (n/4 - term, n/4 + term)


if __name__ == "__main__":

    def latex_table(m, n, cols=5, space="0.5cm"):
        theorem = Theorem()
        values = [(i, theorem.max_cM2(i)) for i in range(m, n+1)]
        while len(values) % cols != 0:
            values.append(("", ""))
        total = len(values)
        rows = total // cols
        print(r"\begin{tabular}{" + "|c|c|"*cols + "}")
        print(r"\hline")
        header = " & ".join([r"$n$ & $k$"]*cols)
        print(header + r"\\ \hline")
        for r in range(rows):
            row_items = []
            for c in range(cols):
                idx = r + c*rows
                n_val, k_val = values[idx]
                if isinstance(k_val, tuple):
                    k_str = r"\textbf{" + ",".join(map(str, k_val)) + "}"
                else:
                    k_str = str(k_val)
                row_items.extend([str(n_val), k_str])
            print(" & ".join(row_items) + r"\\ \hline")
        print(r"\end{tabular}")


    theorem = Theorem()
    print([(n, theorem.tuple_gamma(n)[0], theorem.max_cM2(n)) for n in range(5, 250)])

##### There exist orders n of G, giving two solutions for k,
# such orders n are: [12, 117, 450, 4674, 48620, 505829, 1955714, 20347010, ...]

##### Pairs (n, k, cM2(n,k)) on which second complementary Zagreb index reaches max value:
# [(5, 2, 72), (6, 2, 168), (7, 3, 324), (8, 3, 600), (9, 3, 990), 
# (10, 4, 1560), (11, 4, 2352), (12, 4, 3360), (13, 5, 4760), 
# (14, 5, 6480), (15, 6, 8640), (16, 6, 11340), (17, 6, 14520), 
# (18, 7, 18480), (19, 7, 23100), (20, 8, 28512), (21, 8, 34944), 
# (22, 8, 42224), (23, 9, 50778), (24, 9, 60480), (25, 10, 71400), 
# (26, 10, 84000), (27, 10, 97920), (28, 11, 113696), (29, 11, 131274),
# (30, 12, 150552), (31, 12, 172368), (32, 12, 196080), (33, 13, 222300), 
# (34, 13, 251160), (35, 13, 282282), (36, 14, 316932), (37, 14, 354200), 
# (38, 15, 394680), (39, 15, 438840), (40, 15, 486000), (41, 16, 537600), 
# (42, 16, 592800), (43, 17, 651950), (44, 17, 716040), (45, 17, 783972), 
# (46, 18, 857304), (47, 18, 935424), (48, 19, 1018248), (49, 19, 1107510), 
# (50, 19, 1201560), (51, 20, 1302000), (52, 20, 1408640), (53, 21, 1520736), 
# (54, 21, 1641024), (55, 21, 1767150), (56, 22, 1900668), (57, 22, 2042040), 
# (58, 22, 2189880), (59, 23, 2347380), (60, 23, 2512152), (61, 24, 2685312), 
# (62, 24, 2868240), (63, 24, 3058848), (64, 25, 3260400), (65, 25, 3471000), 
# (66, 26, 3690960), (67, 26, 3922880), (68, 26, 4163796), (69, 27, 4416930), 
# (70, 27, 4681152), (71, 28, 4955664), (72, 28, 5244624), (73, 28, 5544000), 
# (74, 29, 5856840), (75, 29, 6183090), (76, 29, 6520592), (77, 30, 6875160), 
# (78, 30, 7241760), (79, 31, 7623024), (80, 31, 8020320), (81, 31, 8430450), 
# (82, 32, 8859200), (83, 32, 9302400), (84, 33, 9761400), (85, 33, 10239372), 
# (86, 33, 10731864), (87, 34, 11244480), (88, 34, 11774268), 
# (89, 35, 12320910), (90, 35, 12889800), (91, 35, 13475000), 
# (92, 36, 14081760), (93, 36, 14708736), (94, 37, 15353520), 
# (95, 37, 16024182), (96, 37, 16713048), (97, 38, 17424824), 
# (98, 38, 18160200), (99, 38, 18914880), (100, 39, 19698120),
#  (101, 39, 20502222), (102, 40, 21330480), (103, 40, 22186080), 
# (104, 40, 23063040), (105, 41, 23970240), (106, 41, 24901760), 
# (107, 42, 25858560), (108, 42, 26846820), (109, 42, 27858600), 
# (110, 43, 28902192), (111, 43, 29973924), (112, 44, 31071920), 
# (113, 44, 32205888), (114, 44, 33365640), (115, 45, 34558650), 
# (116, 45, 35784000), (117, 45, 37036440), (118, 46, 38329776), 
# (119, 46, 39651264), (120, 47, 41007312), (121, 47, 42400298), 
# (122, 47, 43822800), (123, 48, 45288000), (124, 48, 46785600), 
# (125, 49, 48318900), (126, 49, 49894152), (127, 49, 51501450), 
# (128, 50, 53153100), (129, 50, 54841800), (130, 51, 56567160), 
# (131, 51, 58339920), (132, 51, 60147360), (133, 52, 62000640), 
# (134, 52, 63896040), (135, 53, 65828862), (136, 53, 67814984), 
# (137, 53, 69838524), (138, 54, 71909208), (139, 54, 74027520), 
# (140, 54, 76184820), (141, 55, 78399750), (142, 55, 80655960), 
# (143, 56, 82960416), (144, 56, 85318464), (145, 56, 87718400), 
# (146, 57, 90177648), (147, 57, 92683710), (148, 58, 95238900), 
# (149, 58, 97854120), (150, 58, 100514232), (151, 59, 103235132), 
# (152, 59, 106008840), (153, 60, 108832320), (154, 60, 111722760), 
# (155, 60, 114661200), (156, 61, 117661680), (157, 61, 120721440), 
# (158, 62, 123831360), (159, 62, 127015680), (160, 62, 130251212), 
# (161, 63, 133549794), (162, 63, 136914624), (163, 63, 140332500), 
# (164, 64, 143827200), (165, 64, 147379200), (166, 65, 150995000), 
# (167, 65, 154684530), (168, 65, 158430480), (169, 66, 162254664), 
# (170, 66, 166143120), (171, 67, 170095848), (172, 67, 174130320), 
# (173, 67, 178224690), (174, 68, 182398440), (175, 68, 186643952), 
# (176, 69, 190953912), (177, 69, 195354180), (178, 69, 199817928), 
# (179, 70, 204361920), (180, 70, 208985700), (181, 70, 213675000), 
# (182, 71, 218461320), (183, 71, 223316016), (184, 72, 228251520), 
# (185, 72, 233275392), (186, 72, 238368528), (187, 73, 243559974), 
# (188, 73, 248827800), (189, 74, 254176680), (190, 74, 259623080), 
# (191, 74, 265142592), (192, 75, 270761400), (193, 75, 276465150), 
# (194, 76, 282249864), (195, 76, 288141840), (196, 76, 294110880), 
# (197, 77, 300179880), (198, 77, 306342960), (199, 78, 312586560), 
# (200, 78, 318947772), (201, 78, 325390104), (202, 79, 331932720), 
# (203, 79, 338579148), (204, 79, 345309000), (205, 80, 352160000), 
# (206, 80, 359100000), (207, 81, 366140250), (208, 81, 373294656), 
# (209, 81, 380536704), (210, 82, 387900672), (211, 82, 395363328), 
# (212, 83, 402925824), (213, 83, 410613450), (214, 83, 418393040), 
# (215, 84, 426294960), (216, 84, 434305872), (217, 85, 442415820), 
# (218, 85, 450662520), (219, 85, 459005610), (220, 86, 467471060), 
# (221, 86, 476056440), (222, 86, 484740720), (223, 87, 493571880), 
# (224, 87, 502505040), (225, 88, 511560192), (226, 88, 520746864), 
# (227, 88, 530037024), (228, 89, 539474568), (229, 89, 549024980), 
# (230, 90, 558696600), (231, 90, 568512000), (232, 90, 578435580), 
# (233, 91, 588506646), (234, 91, 598702104), (235, 92, 609017552), 
# (236, 92, 619489728), (237, 92, 630074880), (238, 93, 640807200), 
# (239, 93, 651676110), (240, 94, 662663340), (241, 94, 673820952), 
# (242, 94, 685096440), (243, 95, 696518340), (244, 95, 708089720), 
# (245, 95, 719781750), (246, 96, 731649600), (247, 96, 743644800), 
# (248, 97, 755785200), (249, 97, 768088680)]
