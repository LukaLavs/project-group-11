
from cmath import sqrt, polar, rect, exp
from math import ceil, floor, pi

def cM2(n, k):
    """Complementary second Zagreb index for conjectured graphs"""
    return k*(n-k)*((n-1)**2-k**2)

def cbrt(x): # higher stability than (.)**(1/3)
    r, theta = polar(x) 
    return rect(r**(1/3), theta/3)

def relaxed_max_cM2(n):
    """Solution of cM2_k(n, k) == 0 over reals"""
    xi = 6 * cbrt(-3)**2 * (8 + n*(-16 + 11*n))
    psi = -9 * (n - 2) * n * (3*n - 2) + 4 * sqrt(3) * sqrt(
        -(n - 1)**2 * (32 + n*(-128 + n*(201 + 2*n*(-73 + 34*n)))))
    return (1/72 * (18*n + xi / cbrt(psi) - 6 * cbrt(-3) * cbrt(psi))).real

def gamma(n):
    """By theorem. Equivalent to max_cM2"""
    A = 9*(n-2)*n*(3*n-2) + 4*sqrt(3)*sqrt(-(n-1)**2 * (n*(n*(2*n*(34*n - 73) + 201) - 128) + 32))
    B = (16 - 11*n)*n - 8 
    p = exp(1j * pi / 3)
    h = 1/12 * (3*n - cbrt(3) * p**4 * cbrt(A) + 3**(2/3)*B/(p**4*cbrt(A)))
    h = h.real
    if cM2(n, ceil(h)) == cM2(n, floor(h)):
        return (floor(h), ceil(h))
    return max([floor(h), ceil(h)], key=lambda k: cM2(n, k))

def max_cM2(n):
    """argmax_k cM2(n, k)"""
    k = relaxed_max_cM2(n)
    if cM2(n, ceil(k)) == cM2(n, floor(k)):
        return (floor(k), ceil(k))
    return max(
        [floor(k), ceil(k)], 
        key=lambda k: cM2(n, k)
        )

def convex_from(n):
    return n/4 + sqrt(11*n**2 - 16*n + 8).real / (4 * sqrt(3))

def convex_up_to(n):
        return n/4 - sqrt(11*n**2 - 16*n + 8).real / (4 * sqrt(3))

def latex_table(m, n, cols=5, space="0.5cm"):
    values = [(i, max_cM2(i)) for i in range(m, n+1)]
    print(r"\begin{tabular}{" + "|c|c|"*cols + "}")
    print(r"\hline")
    header = " & ".join([r"$n$ & $k$"]*cols)
    print(header + r"\\ \hline")
    row = []
    for n, k in values:
        if isinstance(k, tuple):
            k_str = ",".join(map(str, k))
        else:
            k_str = str(k)
        if isinstance(k, tuple):
            k_str = r"\textbf{" + k_str + "}"
        row.extend([str(n), k_str])
        if len(row) == cols*2:
            print(" & ".join(row) + r"\\ \hline")
            row = []
    if row:
        row += [""]*(cols*2 - len(row))
        print(" & ".join(row) + r"\\ \hline")
    print(r"\end{tabular}")

##### There exist orders n of G, giving two solutions for k,
# such orders n are: [12, 117, 450, 4674, 48620, 505829, 1955714, 20347010, ...]

##### Pairs (n, k) on which second complementary Zagreb index reaches max value:
# [(5, 2), (6, 2), (7, 3), (8, 3), (9, 3), (10, 4), (11, 4), (12, 4), 
# (13, 5), (14, 5), (15, 6), (16, 6), (17, 6), (18, 7), (19, 7), 
# (20, 8), (21, 8), (22, 8), (23, 9), (24, 9), (25, 10), (26, 10), 
# (27, 10), (28, 11), (29, 11), (30, 12), (31, 12), (32, 12), (33, 13), 
# (34, 13), (35, 13), (36, 14), (37, 14), (38, 15), (39, 15), (40, 15), 
# (41, 16), (42, 16), (43, 17), (44, 17), (45, 17), (46, 18), (47, 18), 
# (48, 19), (49, 19), (50, 19), (51, 20), (52, 20), (53, 21), (54, 21), 
# (55, 21), (56, 22), (57, 22), (58, 22), (59, 23), (60, 23), (61, 24), 
# (62, 24), (63, 24), (64, 25), (65, 25), (66, 26), (67, 26), (68, 26), 
# (69, 27), (70, 27), (71, 28), (72, 28), (73, 28), (74, 29), (75, 29), 
# (76, 29), (77, 30), (78, 30), (79, 31), (80, 31), (81, 31), (82, 32), 
# (83, 32), (84, 33), (85, 33), (86, 33), (87, 34), (88, 34), (89, 35), 
# (90, 35), (91, 35), (92, 36), (93, 36), (94, 37), (95, 37), (96, 37), 
# (97, 38), (98, 38), (99, 38), (100, 39), (101, 39), (102, 40), (103, 40), 
# (104, 40), (105, 41), (106, 41), (107, 42), (108, 42), (109, 42), 
# (110, 43), (111, 43), (112, 44), (113, 44), (114, 44), (115, 45), 
# (116, 45), (117, 45), (118, 46), (119, 46), (120, 47), (121, 47), 
# (122, 47), (123, 48), (124, 48), (125, 49), (126, 49), (127, 49), 
# (128, 50), (129, 50), (130, 51), (131, 51), (132, 51), (133, 52), 
# (134, 52), (135, 53), (136, 53), (137, 53), (138, 54), (139, 54), 
# (140, 54), (141, 55), (142, 55), (143, 56), (144, 56), (145, 56), 
# (146, 57), (147, 57), (148, 58), (149, 58), (150, 58), (151, 59), 
# (152, 59), (153, 60), (154, 60), (155, 60), (156, 61), (157, 61), 
# (158, 62), (159, 62), (160, 62), (161, 63), (162, 63), (163, 63), 
# (164, 64), (165, 64), (166, 65), (167, 65), (168, 65), (169, 66), 
# (170, 66), (171, 67), (172, 67), (173, 67), (174, 68), (175, 68), 
# (176, 69), (177, 69), (178, 69), (179, 70), (180, 70), (181, 70), 
# (182, 71), (183, 71), (184, 72), (185, 72), (186, 72), (187, 73), 
# (188, 73), (189, 74), (190, 74), (191, 74), (192, 75), (193, 75), 
# (194, 76), (195, 76), (196, 76), (197, 77), (198, 77), (199, 78), 
# (200, 78), (201, 78), (202, 79), (203, 79), (204, 79), (205, 80), 
# (206, 80), (207, 81), (208, 81), (209, 81), (210, 82), (211, 82), 
# (212, 83), (213, 83), (214, 83), (215, 84), (216, 84), (217, 85), 
# (218, 85), (219, 85), (220, 86), (221, 86), (222, 86), (223, 87), 
# (224, 87), (225, 88), (226, 88), (227, 88), (228, 89), (229, 89), 
# (230, 90), (231, 90), (232, 90), (233, 91), (234, 91), (235, 92), 
# (236, 92), (237, 92), (238, 93), (239, 93), (240, 94), (241, 94), 
# (242, 94), (243, 95), (244, 95), (245, 95), (246, 96), (247, 96), 
# (248, 97), (249, 97)]